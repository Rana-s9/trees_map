<script>
  let map;

  function initMap() {
  const dataElement = document.getElementById('fav-places-data');
  if (!dataElement) {
      console.error("ãƒ‡ãƒ¼ã‚¿è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
      return;
  }

  const places = JSON.parse(dataElement.getAttribute('data-places') || '[]');
  if (!places.length) {
      console.error("åœ°å›³ã«è¡¨ç¤ºã™ã‚‹å ´æ‰€ãŒã‚ã‚Šã¾ã›ã‚“");
      return;
  }

  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: places[0].latitude, lng: places[0].longitude },
    zoom: 12,
    mapTypeId: "hybrid",
    mapId: "<%= ENV['MAP_ID'] %>",
  });

  const marker = new google.maps.marker.AdvancedMarkerElement({
    map: map,
    position: {
      lat: places[0].latitude,
      lng: places[0].longitude
    }
  });

  const geocoder = new google.maps.Geocoder();

  places.forEach(place => {
    const latLng = new google.maps.LatLng(place.latitude, place.longitude);

    const marker = new google.maps.marker.AdvancedMarkerElement({
      map: map,
      position: latLng,
    });

    // æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ä½œæˆ
    const infoWindow = new google.maps.InfoWindow({
    content: place.fav_name || "ãŠæ°—ã«å…¥ã‚Šã®å ´æ‰€"
    });

    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¡¨ç¤º
    marker.addListener("gmp-click", function () {
    infoWindow.open(map, marker);
    });
  });

    const bounds = new google.maps.LatLngBounds();
    places.forEach(place => {
    bounds.extend(new google.maps.LatLng(place.latitude, place.longitude));
    });
    map.fitBounds(bounds);


  };
</script>
<div class="flex">
  <%= link_to "ã¿ã‚“ãªã®æ¤æ—ãƒ­ã‚°", all_trees_path, data: { turbo: false }, class: "bg-green-400 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition" %>
  <% if user_signed_in? %>
    <%= link_to "#{current_user.user_name} ã®æ¤æ—ãƒ­ã‚°", my_trees_path, data: { turbo: false }, class: "bg-green-400 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition" %>
  <% end %>
</div>

<div class="flex justify-center">
  <button id="map-btn" class="bg-white hover:bg-moss-green text-gray font-bold py-2 px-4 rounded-md shadow-md transition">
    ã‚«ãƒ¡ãƒ©é€£å‹•ãƒãƒƒãƒ—ã‚’è¡¨ç¤º <i class="fa-solid fa-map-pin text-pink-red"></i>
  </button>
</div>
<div class="border-b border-white mb-1"></div>
<div class="btn btn-gray text-white text-xl font-bold" disabled>å›½ãƒ»åœ°åŸŸã‚«ãƒ¡ãƒ©<i class="fa-solid fa-camera text-white"></i>ï¼ˆæœ¨ã‚’è¦‹ã‚‹è¦–ç‚¹ã‚’å¤‰ãˆã¦ã€ã‚ãªãŸã®æœ¨ã‚’ç™ºè¦‹<i class="fa-solid fa-lightbulb text-lemon"></i>ï¼‰</div>
<div id="camera-buttons" class="flex gap-2 p-4">
  <button id="btn-south-america" class="bg-jungle-green hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">å—ç±³/ãƒ–ãƒ©ã‚¸ãƒ«</button>
  <button id="btn-central-america" class="bg-sage-green hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">ä¸­ç±³/ãƒ‘ãƒŠãƒ</button>
  <button id="btn-north-america" class="bg-moss-green hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">åŒ—ç±³/ã‚¢ãƒ¡ãƒªã‚«</button>
  <button id="btn-north" class="bg-grayish-blue hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">åŒ—/ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³</button>
  <button id="btn-west" class="bg-duck-blue hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">è¥¿/ãƒãƒ«ãƒˆã‚¬ãƒ«</button>
  <button id="btn-eastern-europe" class="bg-light-blue hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">æ±ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘/ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠ</button>
  <button id="btn-africa" class="bg-camel hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">ã‚¢ãƒ•ãƒªã‚«/ã‚±ãƒ‹ã‚¢</button>
  <button id="btn-north-africa" class="bg-orange-brown hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">åŒ—ã‚¢ãƒ•ãƒªã‚«/ã‚¨ã‚¸ãƒ—ãƒˆ</button>
  <button id="btn-middle-east" class="bg-terra-cotta hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">ä¸­æ±/ã‚µã‚¦ã‚¸ã‚¢ãƒ©ãƒ“ã‚¢</button>
  <button id="btn-central-asia" class="bg-dry-khaki hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">ä¸­å¤®ã‚¢ã‚¸ã‚¢/ã‚«ã‚¶ãƒ•ã‚¹ã‚¿ãƒ³</button>
  <button id="btn-south-asia" class="bg-olive-green hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">å—ã‚¢ã‚¸ã‚¢/ã‚¤ãƒ³ãƒ‰</button>
  <button id="btn-southeast-asia" class="bg-sage-green hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">æ±å—ã‚¢ã‚¸ã‚¢/ã‚¿ã‚¤</button>
  <button id="btn-east" class="bg-pale-blue-green hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">æ±ã‚¢ã‚¸ã‚¢/æ—¥æœ¬</button>
  <button id="btn-south" class="bg-surf-mint hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition">å—/ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢</button>
  <button id="btn-arctic" class="bg-ice-blue hover:bg-green-600 text-gray font-bold py-2 px-4 rounded-md shadow-md transition">åŒ—æ¥µåœ</button>
  <button id="btn-antarctic" class="bg-fog-blue hover:bg-green-600 text-gray font-bold py-2 px-4 rounded-md shadow-md transition">å—æ¥µåœ</button>
</div>
<div class="border-b border-white"></div>
<button id="btn-refresh">ğŸ”„</button>
<div class = "move">
  <h1 class="text-pink-red font-bold">æ“ä½œã«å›°ã£ãŸã‚‰â‡©<br>
  Ctrl + å·¦ã‚¯ãƒªãƒƒã‚¯ï¼‹ãƒ‰ãƒ©ãƒƒã‚°ã§å‚ç›´/å¹³è¡Œç§»å‹•</h1>
</div>
